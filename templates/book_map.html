

<style>
  body, html {
      height: 100%;
      margin: 0;
  }

  #map {
      height: 100vh; /* Full viewport height */
      width: 100%;
  }

  /* Title overlay box */
  .map-title-box {
      position: absolute;
      top: 20px; /* leave space for navbar */
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.8); /* translucent white */
      padding: 15px 25px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      z-index: 1000; /* keep above map */
  }

  .map-title-box h2 {
      margin: 0;
      font-weight: bold;
      color: #0d6efd;
  }

  .map-title-box p {
      margin: 5px 0 0;
      color: #555;
  }
</style>

<!-- Map title overlay -->
<div class="map-title-box">
    <h2>Select a Parking Lot on Map</h2>
    <p>Click on a marker to see details and reserve your spot.</p>
</div>

<!-- Fullscreen Map -->
<div id="map"></div>

<!-- Leaflet.js CSS + JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// Initialize map centered on Bhopal 
var map = L.map('map').setView([23.2599, 77.4126], 13);

// Tile layer 
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
}).addTo(map);

const reserveBaseUrl = "{{ url_for('user.reserve_spot', lot_id=0) }}";  

// Fetch lots from backend
fetch("{{ url_for('user.get_lots') }}")
  .then(response => response.json())
  .then(lots => {
      lots.forEach(lot => {
          if (lot.latitude && lot.longitude) {
              var marker = L.marker([lot.latitude, lot.longitude]).addTo(map);
              
              let reserveUrl = reserveBaseUrl.replace("0", lot.id);
              
              marker.bindPopup(
                  `<b>${lot.name}</b><br>
                   ${lot.address}<br>
                   Price: ₹${lot.price}/hr<br>
                   Spots: ${lot.max_spots}<br>
                   <a href="${reserveUrl}" class="btn btn-sm btn-primary mt-2">Reserve</a>`
              );
          }
      });
  });
</script>
