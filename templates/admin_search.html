<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
    {% include 'admin_navbar.html' %}
    
    <div class="container mt-5">
        <h2 class="text-primary text-center mb-4">Admin Search Panel</h2>

        <form method="POST" class="d-flex justify-content-center align-items-center gap-3 mb-4">
            <select class="form-select w-25" name="search_type" required>
                <option value="">Search By</option>
                <option value="user" {% if search_type == 'user' %}selected{% endif %}>User</option>
                <option value="lot_name" {% if search_type == 'lot_name' %}selected{% endif %}>Parking Lot by Name</option>
                <option value="lot_number" {% if search_type == 'lot_number' %}selected{% endif %}>Parking Lot by PinCode</option>
            </select>

            <input type="text" name="query" value="{{ query }}" class="form-control w-50" placeholder="Enter search term..." required>

            <button type="submit" class="btn btn-primary">Search</button>
        </form>

        {% if results and search_type == 'user' %}
        <h4 class="text-center text-success mb-3">User Search Results</h4>
        <table class="table table-bordered table-hover text-center">
            <thead class="table-dark">
                <tr>
                    <th>Serial no.</th>
                    <th>Email</th>
                    <th>UserName</th>
                    <th>Full Name</th>
                    <th>Phone Number</th>
                    <th>Pincode</th>
                    <th>Total Bookings</th>
                    <th>View</th>
                </tr>
            </thead>
            <tbody>
                {% for user in results %}
                <tr>
                    <td>{{loop.index }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.full_name }}</td>
                    <td>{{ user.phone_number }}</td>
                    <td>{{ user.pin_code }}</td>
                    <td>{{ user.total_bookings }}</td>
                    <td><a href="{{ url_for('admin.user_booking_history', user_id=user.id) }}"  class="btn btn-info text-white">View History</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% elif results %}
        <h4 class="text-center text-success mb-3">Parking Lot Results</h4>
        <table class="table table-bordered table-hover text-center">
            <thead class="table-dark">
                <tr>
                    <th>Lot ID</th>
                    <th>Parking Name</th>
                    <th>Address</th>
                    <th>Pincode</th>
                    <th>Max Spots</th>
                    <th>Available Spots</th>
                </tr>
            </thead>
            <tbody>
                {% for lot in results %}
                <tr>
                    <td>{{ lot.id }}</td>
                    <td>{{ lot.parking_name }}</td>
                    <td>{{ lot.address }}</td>
                    <td>{{ lot.pin_code }}</td>
                    <td>{{ lot.max_spots }}</td>
                    <td>
                        {{
                            lot.spots | selectattr('status', 'equalto', 'A') 
                                      | selectattr('is_active') 
                                      | list | length
                        }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% elif query %}
        <p class="text-center text-danger">No results found for "{{ query }}"</p>
        {% endif %}
    </div>
</body>
</html>
