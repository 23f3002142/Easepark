<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Parking Stats Summary</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    {% include 'admin_navbar.html' %}

    <!-- Page Heading -->
    <div class="container text-center my-5">
        <h2 class="fw-bold">Parking Statistics Dashboard</h2>
        <p class="text-muted fs-5">A quick overview of parking occupancy, trends, and user activity insights</p>
    </div>

    <!-- First Row: 3 Charts -->
    <div class="container my-4">
        <div class="row mb-4">

            <!-- Left big card: Doughnut -->
            <div class="col-md-6">
                <div class="card shadow-sm" style="height: 500px;">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <h5 class="card-title text-center mb-3">Parking Lot Occupancy Overview</h5>
                        <canvas id="occupancyChart" style="max-height: 350px;"></canvas>
                        <script>
                            const occupiedSpots = "{{ occupied_spots }}";
                            const availableSpots = "{{ available_spots }}";

                            new Chart(document.getElementById('occupancyChart'), {
                                type: 'doughnut',
                                data: {
                                    labels: ['Occupied', 'Available'],
                                    datasets: [{
                                        data: [occupiedSpots, availableSpots],
                                        backgroundColor: [
                                            'rgba(255, 99, 132, 0.7)',
                                            'rgba(75, 192, 192, 0.7)'
                                        ],
                                        borderColor: [
                                            'rgba(255, 99, 132, 1)',
                                            'rgba(75, 192, 192, 1)'
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    plugins: {
                                        legend: {
                                            position: 'bottom'
                                        },
                                        title: {
                                            display: true,
                                            text: 'Current Parking Occupancy'
                                        }
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>
            </div>

            <!-- Right side: 2 stacked cards -->
            <div class="col-md-6 d-flex flex-column gap-4">

                <!-- Top small card: Monthly Usage -->
                <div class="card shadow-sm" style="height: 240px;">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <h5 class="card-title text-center mb-2">Monthly Parking Usage Trends</h5>
                        <canvas id="monthlyUsageChart" style="max-height: 150px;"></canvas>
                        <script>
                            const monthlyLabels = {{ months | tojson }};
                            const monthlyBookings = {{ bookings_per_month | tojson }};

                            new Chart(document.getElementById('monthlyUsageChart'), {
                                type: 'bar',
                                data: {
                                    labels: monthlyLabels,
                                    datasets: [{
                                        label: 'Vehicles Parked',
                                        data: monthlyBookings,
                                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                                        borderColor: 'rgba(75, 192, 192, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Monthly Parking Usage (Last 2 Months)'
                                        }
                                    },
                                    scales: {
                                        x: {
                                            title: { display: true, text: 'Month' }
                                        },
                                        y: {
                                            beginAtZero: true,
                                            title: { display: true, text: 'Number of Vehicles' }
                                        }
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>

                <!-- Bottom small card: User Registration -->
                <div class="card shadow-sm" style="height: 240px;">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <h5 class="card-title text-center mb-2">User Registration Stats</h5>
                        <canvas id="userRegistrationChart" style="max-height: 150px;"></canvas>
                        <script>
                            const userLabels = {{ labels | tojson }};
                            const userData = {{ data | tojson }};

                            new Chart(document.getElementById('userRegistrationChart'), {
                                type: 'bar',
                                data: {
                                    labels: userLabels,
                                    datasets: [{
                                        label: 'New Users Registered',
                                        data: userData,
                                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: { stepSize: 1 }
                                        }
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <!-- Section Divider -->
    <div class="container my-5 text-center">
        <h4 class="fw-bold">Advanced Insights</h4>
        <hr class="mx-auto" style="width: 120px; border-top: 3px solid #0d6efd;">
    </div>

    <!-- Second Row: Top Locations & Avg Parking Time -->
    <div class="container my-4">
        <div class="row g-4">
            <!-- Top Locations -->
            <div class="col-md-6">
                <div class="card shadow-lg border-0 h-100">
                    <div class="card-body">
                        <h5 class="card-title text-center mb-3">Top Parking Locations by Usage</h5>
                        <canvas id="topLocationsChart"></canvas>
                        <script>
                            const topLabels = {{ labels1 | tojson }};
                            const topData = {{ data1 | tojson }};

                            new Chart(document.getElementById('topLocationsChart'), {
                                type: 'bar',
                                data: {
                                    labels: topLabels,
                                    datasets: [{
                                        label: 'Usage Count',
                                        data: topData,
                                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                                        borderColor: 'rgba(255, 99, 132, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    indexAxis: 'y',
                                    responsive: true,
                                    scales: {
                                        x: { beginAtZero: true }
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>
            </div>

            <!-- Avg Parking Time -->
            <div class="col-md-6">
                <div class="card shadow-lg border-0 h-100">
                    <div class="card-body">
                        <h5 class="card-title text-center mb-3">Average Parking Time per Lot (hours)</h5>
                        <canvas id="avgParkingTimeChart"></canvas>
                        <script>
                            const avgLabels = {{ labels2 | tojson }};
                            const avgData = {{ data2 | tojson }};

                            new Chart(document.getElementById('avgParkingTimeChart'), {
                                type: 'bar',
                                data: {
                                    labels: avgLabels,
                                    datasets: [{
                                        label: 'Avg Parking Time (hrs)',
                                        data: avgData,
                                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                                        borderColor: 'rgba(75, 192, 192, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    scales: {
                                        y: { beginAtZero: true }
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
</body>

</html>